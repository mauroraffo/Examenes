<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Klinge Lite ‚Äî Ex√°menes (v5)</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a"/>
  <style>
:root{ --bg:#0b1220; --panel:#111827; --border:#1f2937; --txt:#e5e7eb; --muted:#9ca3af; --brand:#93c5fd; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;}
*{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
@supports(padding:env(safe-area-inset-bottom)){ body{padding-bottom:env(safe-area-inset-bottom)}}
header{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.75rem .9rem;background:rgba(17,24,39,.9);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.title{font-weight:700;letter-spacing:.2px;color:var(--brand)}
.wrap{display:grid;grid-template-columns:1fr;gap:.9rem;padding:.9rem} @media(min-width:940px){ .wrap{grid-template-columns:1.6fr .9fr}}
.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:.9rem}
.badge{display:inline-block;padding:.15rem .5rem;border:1px solid var(--border);border-radius:999px;font-size:.72rem;color:#c7d2fe}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:.9rem}
.pos{min-height:170px;display:flex;flex-direction:column}
.pos .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:.25rem}
.pos .head h3{margin:0;font-size:1rem}
.pos .body{flex:1;display:grid;gap:.25rem}
.pos .foot{margin-top:.3rem;color:var(--muted);font-size:.78rem}
label{display:block;color:var(--muted);font-size:.8rem;margin:.4rem 0 .2rem}
input,select,button{width:100%;padding:.7rem .75rem;border-radius:12px;border:1px solid var(--border);background:#0b1220;color:var(--txt);outline:none}
button{font-weight:700} .btn-primary{background:#1f2937} .btn-cta{background:var(--brand);color:#0b1220;border-color:transparent} .btn-danger{background:#3f1d1d;border-color:#7f1d1d}
.actions{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.6rem} @media(max-width:480px){ .actions{grid-template-columns:1fr}}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#12221a;border:1px solid #1e3a2f;color:#c6f6d5;padding:.6rem .8rem;border-radius:12px;display:none;z-index:200}
.toast.show{display:block}
.diag{margin-top:.4rem;font-size:.78rem} .diag.ok{color:#86efac} .diag.err{color:#fecaca}
.accordion summary{cursor:pointer;color:var(--brand);font-weight:700} .accordion{margin:.2rem 0 .6rem}
  </style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:.6rem">
    <img src="icons/icon-192.png" alt="logo" style="height:28px"/>
    <div>
      <div class="title">Klinge Lite ‚Äî HTML/PWA</div>
      <div style="font-size:.78rem;color:var(--muted)">P1‚ÄìP4 + Borradores + Export maestro</div>
    </div>
  </div>
  <div style="display:flex;gap:.4rem;flex-wrap:wrap">
    <a class="badge" href="#" id="btnSaveDrafts">Exportar borradores (JSON)</a>
    <label class="badge" style="cursor:pointer">Importar borradores
      <input type="file" id="loadDrafts" accept="application/json" style="display:none">
    </label>
    <a class="badge" href="#" id="btnInstall">Instalar</a>
  </div>
</header>

<div class="wrap">
  <main>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700">Equipo: <span id="equiponame">‚Äî</span></div>
          <div style="color:var(--muted);font-size:.85rem">√öltimo evento: <span id="fechalast">‚Äî</span> ‚Ä¢ Hor√≥metro: <span id="horolast">‚Äî</span></div>
        </div>
        <span class="badge">Vista</span>
      </div>
      <div class="grid" style="margin-top:.8rem">
        <div class="card pos">
          <div class="head"><h3>P1</h3></div>
          <div id="p1c" class="body"></div>
          <div id="p1f" class="foot"></div>
        </div>
        <div class="card pos">
          <div class="head"><h3>P2</h3></div>
          <div id="p2c" class="body"></div>
          <div id="p2f" class="foot"></div>
        </div>
        <div class="card pos">
          <div class="head"><h3>P3</h3></div>
          <div id="p3c" class="body"></div>
          <div id="p3f" class="foot"></div>
        </div>
        <div class="card pos">
          <div class="head"><h3>P4</h3></div>
          <div id="p4c" class="body"></div>
          <div id="p4f" class="foot"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:.9rem">
      <div class="title">‚ûï Examen ‚Äî por posici√≥n</div>
      <div style="color:var(--muted);font-size:.85rem">Serie, Rem. Izq/Der, CT, PSI y fotos m√∫ltiples. Guarda como borrador; luego exporta a Excel maestro + ZIP.</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-top:.6rem">
        <div>
          <label>Fecha del examen</label>
          <input type="date" id="fechaExam"/>
        </div>
        <div>
          <label>Hor√≥metro del equipo</label>
          <input type="text" id="horoExam"/>
        </div>
      </div>
      <div id="formPos" class="grid" style="margin-top:.6rem"></div>
      <div class="actions" style="margin-top:.8rem">
        <button class="btn-primary" id="btnSave">üíæ Guardar borrador / cambios</button>
        <button class="btn-danger"  id="btnDelete">üóëÔ∏è Eliminar borrador actual</button>
        <button class="btn-cta"     id="btnExport">üì¶ Exportar TODOS ‚Üí Excel maestro + ZIP</button>
      </div>
    </div>
  </main>

  <aside>
    <div class="card accordion">
      <details open>
        <summary>1) Cargar CSV hist√≥rico</summary>
        <input type="file" id="csv" accept=".csv"/>
        <div class="diag" id="diag">Separado por ;</div>
      </details>
      <details>
        <summary>2) Filtrar</summary>
        <label>Flota</label>
        <select id="flota"></select>
        <label>Equipo</label>
        <input type="text" id="buscaEquipo" placeholder="Buscar..."/>
        <select id="equipo" size="6"></select>
      </details>
      <details>
        <summary>üìã Borradores</summary>
        <div id="draftList" class="muted">Sin borradores.</div>
      </details>
    </div>
  </aside>
</div>

<div class="toast" id="toast">Guardado</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="app.js"></script>
<script>if('serviceWorker'in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('service-worker.js'));}</script>
</body>
</html>
